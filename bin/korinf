#!/bin/sh
##
#  Korinf project
#
#  Common script for build any package in build farm
#
#  Copyright (c) Etersoft <http://etersoft.ru> 2005, 2006, 2007, 2009
#  Copyright (c) Vitaly Lipatov <lav@etersoft.ru> 2009
#
#  This program is free software; you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation; either version 3 of the License, or
#  (at your option) any later version.
#
#  This program is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with this program.  If not, see <http://www.gnu.org/licenses/>.
##

# load common functions, compatible with local and installed script
. `dirname $0`/../share/eterbuild/korinf/common

if [ -z "$1" ] ; then
	echo "Use: korinf [System/Version] PackageName" >&2
	exit 1
fi

kormod korinf

if [ -n "$2" ] ; then
	REBUILDLIST=$1
	shift
fi

BUILDNAME=$1

SOURCEPATH=$BUILDFARMDIR/sources
TARGETPATH=$BUILDFARMDIR/$BUILDNAME

set_rebuildlist

# For build farm check global distro.list before build for all
if [ "$REBUILDLIST" = "$KORINFETC/lists/all" ] ; then
	if [ -r "$BUILDFARMDIR/distro.list" ] ; then
		REBUILDLIST=$BUILDFARMDIR/distro.list
		echo "Build $BUILDNAME according to distro.list from $BUILDFARMDIR"
	fi
fi

build_package $BUILDNAME
