#!/bin/sh
# 2005, 2006, 2007, 2009 (c) Etersoft http://etersoft.ru
# Author: Vitaly Lipatov <lav@etersoft.ru>
# GNU Public License

# load common functions, compatible with local and installed script
. `dirname $0`/../share/eterbuild/korinf/common

if [ -z "$1" ] ; then
	echo "Use: korinf [System/Version] PackageName" >&2
	exit 1
fi

kormod helpers

if [ -n "$2" ] ; then
	REBUILDLIST=$1
	shift
fi

BUILDNAME=$1

if [ -n "$REBUILDLIST" ] ; then
	echo "Build $BUILDNAME for $REBUILDLIST"
else
	if [ -r "$BUILDFARMDIR/distro.list" ] ; then
		REBUILDLIST=$BUILDFARMDIR/distro.list
		echo "Build $BUILDNAME according to distro.list from $BUILDFARMDIR"
	else
		REBUILDLIST=$KORINFETC/lists/rebuild.list.all
		echo "Build $BUILDNAME for distros from $REBUILDLIST"
	fi
fi

SOURCEPATH=$BUILDFARMDIR/sources
TARGETPATH=$BUILDFARMDIR/$BUILDNAME

# debug mode
#ADEBUG=1

# install packages after build
#BOOTSTRAP=1

build_package $BUILDNAME
